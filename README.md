# plaid-study-20180605

# Dockerの理想形
コードがデプロイされる開発環境・CI環境・ステージング環境・本番環境が統一されています。OSの種類・ライブラリ・ミドルウェアの構成が記述的に構築されており、完全に同一です。どこかのステージだけ環境依存の問題が発生する……というような厄介な問題が起きません  
かららしい全くもってその通りだと思う


スライドのみかた
------------

* `cd ./slide`
* `docker-compose up -d`
* `localhost:82`にブラウザでアクセス

## volumeも消すことがきる
```php
docker-compose down -v
```
# 学び

## image
マウントするシステムファイルや起動時の設定をするもの
## container
仮装マシンインスタンスimageを元にbuildされる
## compose
複数のコンテナーを設定を一元管理できるツール、１つずつ立ち上げるのではなく、同時にコンテナーを作成できる
## volume
コンテナーとは別に独立して管理しているデータ  
コンテナーを削除するだけでは消えない 独立しているから
Host volumeとはホスト側のディレクトリツリーをvolumeとしてコンテナーにマウントする事　ここは重要
## port
外部システムと通信するためのポートバインド  
外部システムと通信する為のポートを作成する Dockerfileに書いている


# その他
## メモリ
記憶装置の事 揮発性メモリ 非揮発性メモリがある  
揮発性はpcの電源が落ちると記憶していたものも消えてしまう。  
非揮発性メモリはHDD SSDがある  
SSDは半導体記憶素子に記憶させる  
メモリの中でOSを使用している部分を物理メモリという  
物理メモリの中でappに使用するメモリを仮想メモリという  
メモリの使用量が大きくなるとSSDやHDDに一時的に書き出して負荷を分散させる  
HDDがカリカリ音がするのはこの為  
以上の理由でメモリの容量は多い方が良いとされている  
ちなみに弊社のmacbook proはメモリ16GB SSD 1TB!である  
execで接続したらexitしてもコンテナは起動したままになる

## ステージング環境
ステージング環境とは、本番環境に条件を限りなく近づけた「最終テスト用に用いる、本番環境と類似のテスト環境」を指します  
本番環境に限りなく近づけたテスト用の環境 テスト環境とは違う!?  

## build deploy
複数のソースコードを機械語に翻訳するのがコンパイル  
コンパイルしたものを一つの実行ファイルにまとめあげるのが**リンク**  
- build コンパイルして一つの実行ファイルにするもの
- deploy 実行ファイルを環境に合わせて実行できるようにするもの  


```php
$ docker run -d -p 80:80 -v $(pwd)/nginx/log:/var/log/nginx --name webserver nginx
-p 80:80 :ホスト側の80番portをコンテナ側の80番portに転送する　-p 8080:80 とすればlocalhost:8080 で使用できる
-v $(pwd)/nginx/log:/var/log/nginx :このホスト側のディレクトリをvolumeとしてコンテナ側のディレクトリにマウントする
-name webserver :コンテナの名前を指定する
```

### 実行中のプロセス確認
```
ps aux | grep : 文字列
sudo lsof -i:80
sudoを付けないとプロセスが確認できないかも?本人以外で使ってるプロセスだとできなからかなぁ
```

commitでコンテナをイメージ化することができる imageを削除するにはrmi  



